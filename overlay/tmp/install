#!/bin/sh

set -euo pipefail
export BF_E=`basename ${0}`


#======================================================================================================================
# Get ClamAV Version.
#======================================================================================================================

cd /tmp

VERSION=$(cat CLAMAV_BUILD)
bf-echo "ClamAV version ${VERSION}."


#======================================================================================================================
# Install ClamAV and dependencies.
#======================================================================================================================

bf-echo "Installing ClamAV v${VERSION}..."
apk add --no-cache \
    clamav-daemon=${VERSION} \
    clamav-libunrar=${VERSION}
bf-done


#======================================================================================================================
# Download the main database so startup is much quicker (makes for larger image size).
#======================================================================================================================

freshclam


#======================================================================================================================
# Cleanup.
#======================================================================================================================

bf-echo "Cleaning up default ClamAV configuration."
rm -rf /etc/clamav/*
